name: å–æ°´æé†’æœºå™¨äºº

on:
  # å®šæ—¶è§¦å‘ï¼šå·¥ä½œæ—¥æ¯å°æ—¶ä¸€æ¬¡ï¼ˆåŒ—äº¬æ—¶é—´9ç‚¹åˆ°18ç‚¹ï¼‰
  schedule:
    - cron: '0 1-10 * * 1-6'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘æµ‹è¯•
  workflow_dispatch:

jobs:
  remind:
    runs-on: ubuntu-latest
    
    steps:
    - name: å‘é€å–æ°´æé†’
      env:
        WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
        SECRET: ${{ secrets.DINGTALK_SECRET }}
      run: |
        # ç”Ÿæˆæ—¶é—´æˆ³å’Œç­¾å
        timestamp=$(date +%s%3N)
        sign=$(echo -n "${timestamp}\n${SECRET}" | openssl dgst -sha256 -hmac "${SECRET}" -binary | base64)
        sign=$(echo $sign | tr -d '\n')
        
        # æ„å»ºæ¶ˆæ¯å†…å®¹
        DATA='{
          "msgtype": "markdown",
          "markdown": {
            "title": "ğŸ’§ å–æ°´æ—¶é—´åˆ°ï¼",
            "text": "### ğŸš° å–æ°´æé†’ \n\nç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ $(date +"%H:%M") \n\nè¯·ç«™èµ·æ¥æ´»åŠ¨ä¸€ä¸‹ï¼Œå–æ¯æ°´å§ï¼\n\nğŸ’¡ å°è´´å£«ï¼šæ¯å°æ—¶è¡¥å……æ°´åˆ†æœ‰åŠ©äºä¿æŒç²¾åŠ›å……æ²›"
          }
        }'
        
        # å‘é€åˆ°é’‰é’‰
        curl -H "Content-Type: application/json" \
             -X POST \
             "${WEBHOOK}&timestamp=${timestamp}&sign=${sign}" \
             -d "${DATA}"
        
        echo "âœ… æé†’å·²å‘é€ï¼"
